import{_ as i,c as n,a5 as l,o as p}from"./chunks/framework.DoP1wijR.js";const a="/pub-blog/assets/image-20240608002954074.BnxIRVR9.png",e="/pub-blog/assets/image-20240608004247416.D6K3M-wL.png",t="/pub-blog/assets/image-20240608004726930.0ymRP1jJ.png",h="/pub-blog/assets/image-20240608004827845.DCeOGnei.png",r="/pub-blog/assets/image-20240608005114527.ChD8xQ3a.png",k="/pub-blog/assets/image-20240608005144778.CFF5YU_f.png",E="/pub-blog/assets/image-20240608005334602.C3OJ2NV1.png",o="/pub-blog/assets/image-20240608005438191.DqCnfY03.png",c="/pub-blog/assets/image-20240608010002233.BXLMRlML.png",d="/pub-blog/assets/image-20240608010016337.Bn-rfBHn.png",_=JSON.parse('{"title":"高质量 HarmonyOS  权限管控流程","description":"","frontmatter":{},"headers":[],"relativePath":"鸿蒙开发技巧/鸿蒙应用开发权限一览/鸿蒙应用开发权限一览.md","filePath":"鸿蒙开发技巧/鸿蒙应用开发权限一览/鸿蒙应用开发权限一览.md","lastUpdated":1737132805000}'),g={name:"鸿蒙开发技巧/鸿蒙应用开发权限一览/鸿蒙应用开发权限一览.md"};function b(m,s,y,u,F,C){return p(),n("div",null,s[0]||(s[0]=[l('<h1 id="高质量-harmonyos-权限管控流程" tabindex="-1">高质量 HarmonyOS 权限管控流程 <a class="header-anchor" href="#高质量-harmonyos-权限管控流程" aria-label="Permalink to &quot;高质量 HarmonyOS  权限管控流程&quot;">​</a></h1><p>在 <strong>HarmonyOS</strong> 应用开发过程中，往往会涉及到<strong>敏感数据</strong>和<strong>硬件资源</strong>的调动和访问，而这部分的调用就会涉及到管控这部分的知识和内容了。我们需要对它有所了解，才可以在应用开发中提高效率和避免踩坑。</p><h2 id="权限管控了什么" tabindex="-1">权限管控了什么 <a class="header-anchor" href="#权限管控了什么" aria-label="Permalink to &quot;权限管控了什么&quot;">​</a></h2><p>权限管控，主要是管控 <strong>数据</strong>和<strong>功能</strong>。</p><ul><li>数据包括个人数据（如照片、通讯录、日历、位置等）、设备数据（如设备标识、相机、麦克风等）。</li><li>功能包括设备功能（如访问摄像头/麦克风、打电话、联网等）、应用功能（如弹出悬浮窗、创建快捷方式等）。</li></ul><h2 id="权限组和子权限" tabindex="-1">权限组和子权限 <a class="header-anchor" href="#权限组和子权限" aria-label="Permalink to &quot;权限组和子权限&quot;">​</a></h2><p>我们先看什么是子权限。比如对于媒体相册的功能操作来说。读取相册内容是一种权限、写入内容到相册是一种权限。 那么它们属于媒体相册这个大权限中的子权限。那么我们的应用在申请媒体相册的读写权限时，考虑到用户的体验。其实是会把两个权限合并为一个弹出窗口，询问用户授予权限。如果用户允许了，那么就等于获得了媒体相册的读写权限了。总结就是</p><ul><li>读取媒体相册是子权限、写入媒体相册是子权限</li><li>它们合起来就是一个权限组。</li></ul><p><img src="'+a+`" alt="image-20240608002954074"></p><h2 id="权限组和子权限一览" tabindex="-1">权限组和子权限一览 <a class="header-anchor" href="#权限组和子权限一览" aria-label="Permalink to &quot;权限组和子权限一览&quot;">​</a></h2><blockquote><p><a href="https://docs.openharmony.cn/pages/v4.1/zh-cn/application-dev/security/AccessToken/app-permission-group-list.md" target="_blank" rel="noreferrer">链接</a></p></blockquote><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">位置信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LOCATION_IN_BACKGROUND</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LOCATION</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">APPROXIMATELY_LOCATION</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">相机</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CAMERA</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">麦克风</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MICROPHONE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">通讯录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_CONTACTS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_CONTACTS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">日历</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_CALENDAR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_CALENDAR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_WHOLE_CALENDAR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_WHOLE_CALENDAR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">健身运动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ACTIVITY_MOTION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">身体传感器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_HEALTH_DATA</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">图片和视频</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_IMAGEVIDEO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_IMAGEVIDEO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MEDIA_LOCATION</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">音乐和音频</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_AUDIO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_AUDIO</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_DOCUMENT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_DOCUMENT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_MEDIA</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_MEDIA</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">广告跟踪</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">APP_TRACKING_CONSENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">读取已安装应用列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GET_INSTALLED_BUNDLE_LIST</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">多设备协同</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DISTRIBUTED_DATASYNC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">蓝牙</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ACCESS_BLUETOOTH</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">电话</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ANSWER_CALL</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MANAGE_VOICEMAIL</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">通话记录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_CALL_LOG</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">WRITE_CALL_LOG</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_CELL_MESSAGES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_MESSAGES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RECEIVE_MMS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RECEIVE_SMS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RECEIVE_WAP_MESSAGES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SEND_MESSAGES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">剪切板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_PASTEBOARD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">文件夹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_WRITE_DOWNLOAD_DIRECTORY</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_WRITE_DESKTOP_DIRECTORY</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ohos.permission.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READ_WRITE_DOCUMENTS_DIRECTORY</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h2 id="apl等级" tabindex="-1">APL等级 <a class="header-anchor" href="#apl等级" aria-label="Permalink to &quot;APL等级&quot;">​</a></h2><p>APL（Ability Privilege Level，元能力权限等级）等级，分为两类。一类是<strong>应用APL等级</strong>、另一类是<strong>权限APL等级</strong>。说人话就是 不管官阶的士官和其对应的权限之间的关系。</p><h3 id="应用apl等级" tabindex="-1">应用APL等级 <a class="header-anchor" href="#应用apl等级" aria-label="Permalink to &quot;应用APL等级&quot;">​</a></h3><p>应用APL等级分为三级：</p><table tabindex="0"><thead><tr><th style="text-align:left;">APL级别</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">normal</td><td style="text-align:left;">默认情况下，应用的APL等级都为normal等级。</td></tr><tr><td style="text-align:left;">system_basic</td><td style="text-align:left;">该等级的应用服务提供系统基础服务。</td></tr><tr><td style="text-align:left;">system_core</td><td style="text-align:left;">该等级的应用服务提供操作系统核心能力。 应用APL等级不允许配置为system_core。</td></tr></tbody></table><h3 id="权限apl等级" tabindex="-1">权限APL等级 <a class="header-anchor" href="#权限apl等级" aria-label="Permalink to &quot;权限APL等级&quot;">​</a></h3><p>权限APL等级也分为三级：</p><table tabindex="0"><thead><tr><th style="text-align:left;">APL级别</th><th style="text-align:left;">说明</th><th style="text-align:left;">开放范围</th></tr></thead><tbody><tr><td style="text-align:left;">normal</td><td style="text-align:left;">允许应用访问超出默认规则外的普通系统资源，如配置Wi-Fi信息、调用相机拍摄等。 这些系统资源的开放（包括数据和功能）对用户隐私以及其他应用带来的风险低。</td><td style="text-align:left;">APL等级为normal及以上的应用。</td></tr><tr><td style="text-align:left;">system_basic</td><td style="text-align:left;">允许应用访问操作系统基础服务（系统提供或者预置的基础功能）相关的资源，如系统设置、身份认证等。 这些系统资源的开放对用户隐私以及其他应用带来的风险较高。</td><td style="text-align:left;">APL等级为system_basic及以上的应用。</td></tr><tr><td style="text-align:left;">system_core</td><td style="text-align:left;">涉及开放操作系统核心资源的访问操作。这部分系统资源是系统最核心的底层服务，如果遭受破坏，操作系统将无法正常运行。</td><td style="text-align:left;">- APL等级为system_core的应用。 - 仅对系统应用开放。</td></tr></tbody></table><h2 id="访问控制列表-acl" tabindex="-1">访问控制列表（ACL） <a class="header-anchor" href="#访问控制列表-acl" aria-label="Permalink to &quot;访问控制列表（ACL）&quot;">​</a></h2><p><strong>权限等级</strong>和应用APL等级是一一对应的。原则上，拥有低APL等级的应用默认无法申请更高等级的权限。访问控制列表<strong>ACL（Access Control List）<strong>提供了解决低等级应用访问高等级权限问题的特殊渠道。我们可以将ACL理解为</strong>让普通的老百姓也具有某种士官的能力，如调兵遣将</strong>。</p><p>需要注意的是，并不是所有的权限都能通过申请ACL来实现跨等级的应用来获得。具体哪些权限可以被跨等级申请使用。<strong>HarmonyOS</strong>中也有明确标识的。如： <a href="https://docs.openharmony.cn/pages/v4.1/zh-cn/application-dev/security/AccessToken/permissions-for-all.md#systemgrant%E7%B3%BB%E7%BB%9F%E6%8E%88%E6%9D%83%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8" target="_blank" rel="noreferrer">链接</a></p><p><img src="`+e+'" alt="image-20240608004247416"></p><h2 id="授权方式" tabindex="-1">授权方式 <a class="header-anchor" href="#授权方式" aria-label="Permalink to &quot;授权方式&quot;">​</a></h2><p>不管是什么的方式申请权限，最后在用户的体验上一共分为两种。 system_grant（系统授权） 和 user_grant（用户授权）</p><ol><li><p>system_grant（系统授权）</p><ul><li>应用被允许访问的数据不会涉及到用户或设备的敏感信息</li><li>需要在安装包中申请system_grant权限，那么系统会在用户安装应用时，<strong>自动把相应权限授予给应用</strong>。</li></ul></li><li><p>user_grant（用户授权）</p><ul><li><p><strong>会弹出窗口询问用户的意见</strong>-应用被允许访问的数据将会涉及到用户或设备的敏感信息</p></li><li><p>需要注意的是，如果用户增加拒绝过授权，那么只能通过引导用户到系统设置页面来手动打开权限</p></li></ul><p><img src="'+t+'" alt="image-20240608004726930"></p></li></ol><h2 id="申请应用权限流程" tabindex="-1">申请应用权限流程 <a class="header-anchor" href="#申请应用权限流程" aria-label="Permalink to &quot;申请应用权限流程&quot;">​</a></h2><p>一图胜万言</p><h3 id="总流程图" tabindex="-1">总流程图 <a class="header-anchor" href="#总流程图" aria-label="Permalink to &quot;总流程图&quot;">​</a></h3><p><img src="'+h+'" alt="image-20240608004827845"></p><hr><h3 id="normal等级的应用申请权限" tabindex="-1">normal等级的应用申请权限 <a class="header-anchor" href="#normal等级的应用申请权限" aria-label="Permalink to &quot;normal等级的应用申请权限&quot;">​</a></h3><p><img src="'+r+'" alt="image-20240608005114527"></p><h3 id="system-basic等级的应用申请权限" tabindex="-1">system_basic等级的应用申请权限 <a class="header-anchor" href="#system-basic等级的应用申请权限" aria-label="Permalink to &quot;system_basic等级的应用申请权限&quot;">​</a></h3><p><img src="'+k+'" alt="image-20240608005144778"></p><h2 id="申请应用权限操作步骤" tabindex="-1">申请应用权限操作步骤 <a class="header-anchor" href="#申请应用权限操作步骤" aria-label="Permalink to &quot;申请应用权限操作步骤&quot;">​</a></h2><h3 id="_1-声明权限-必须" tabindex="-1">1.声明权限-必须 <a class="header-anchor" href="#_1-声明权限-必须" aria-label="Permalink to &quot;1.声明权限-必须&quot;">​</a></h3><ol><li><p>在 <strong>main/module.json5</strong> 中 配置 <strong>requestPermissions</strong> 字段声明权限</p></li><li><p>配置内容</p><p><img src="'+E+'" alt="image-20240608005334602"></p></li></ol><h3 id="_2-声明acl权限-非必须" tabindex="-1">2.声明ACL权限-非必须 <a class="header-anchor" href="#_2-声明acl权限-非必须" aria-label="Permalink to &quot;2.声明ACL权限-非必须&quot;">​</a></h3><blockquote><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing-0000001587684945" target="_blank" rel="noreferrer">参考链接</a></p></blockquote><p><img src="'+o+`" alt="image-20240608005438191"></p><h3 id="_3-向用户申请授权-非必须" tabindex="-1">3.向用户申请授权-非必须 <a class="header-anchor" href="#_3-向用户申请授权-非必须" aria-label="Permalink to &quot;3.向用户申请授权-非必须&quot;">​</a></h3><p>如果你申请的权限类型是 <strong>system_grant（系统授权）</strong>，那么可以跳过这个步骤。如果你申请的权限类型是 <strong>user_grant（用户授权）</strong>，那么需要主动申请权限，此时用户会弹出对话框。如</p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abilityAccessCtrl, { Context, PermissionRequestResult } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@ohos.abilityAccessCtrl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { BusinessError } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@ohos.base&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> common </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@ohos.app.ability.common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> atManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> abilityAccessCtrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AtManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> abilityAccessCtrl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createAtManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UIAbilityContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 申请摄像头权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">atManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestPermissionsFromUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ohos.permission.CAMERA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PermissionRequestResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data permissions:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.permissions);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data authResults:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.authResults);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BusinessError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data:&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><hr><p><em>此图只做演示，不和上述代码具体效果一一对应</em></p><p><img src="`+a+`" alt="image-20240608002954074"></p><h3 id="_4-访问接口-必须" tabindex="-1">4.访问接口-必须 <a class="header-anchor" href="#_4-访问接口-必须" aria-label="Permalink to &quot;4.访问接口-必须&quot;">​</a></h3><p>此时，就可以直接调用相关接口，实现业务功能</p><h3 id="_5-当用户拒绝时-二次申请权限" tabindex="-1">5. 当用户拒绝时，二次申请权限 <a class="header-anchor" href="#_5-当用户拒绝时-二次申请权限" aria-label="Permalink to &quot;5. 当用户拒绝时，二次申请权限&quot;">​</a></h3><p>针对以上弹窗，如果用户点击了<strong>禁止</strong>，我们可以再次弹窗询问用户，如 “不授予权则无法继续使用功能”，“禁止”，“允许”。</p><p>此时，如果用户点击了允许</p><ol><li><p>使用 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-abilityaccessctrl-V5#requestpermissiononsetting12" target="_blank" rel="noreferrer">requestPermissionOnSetting</a> 在应用内直接弹窗 请求授权</p></li><li><p>使用 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-inner-application-uiabilitycontext-V5#uiabilitycontextstartability" target="_blank" rel="noreferrer">startAbility</a> 跳转到系统权限设置页面，重新授权权限\`</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> want</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Want</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  bundleName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;com.huawei.hmos.settings&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  abilityName: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;com.huawei.hmos.settings.MainAbility&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  uri: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application_info_entry&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> common</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UIAbilityContext</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startAbility</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(want)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol><h2 id="附上述流程思维导图" tabindex="-1">附上述流程思维导图 <a class="header-anchor" href="#附上述流程思维导图" aria-label="Permalink to &quot;附上述流程思维导图&quot;">​</a></h2><p><img src="`+c+'" alt="image-20240608010002233"></p><hr><p><img src="'+d+'" alt="image-20240608010016337"></p>',58)]))}const B=i(g,[["render",b]]);export{_ as __pageData,B as default};
